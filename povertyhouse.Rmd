---
title: "Poverty Status by Household Type"
description: |
  POVERTY STATUS IN THE PAST 12 MONTHS OF FAMILIES BY HOUSEHOLD TYPE BY EDUCATIONAL ATTAINMENT OF HOUSEHOLDER<br /> Table: B17018 - Variables used: 16-20
output_dir: "_site"
site: distill::distill_website
search: TRUE
---

```{r, load_variables}
#census_api_key("67cbcd7b6d617916475eb5bd88439380a2511582", install = TRUE)
#readRenviron("~/.Renviron")

all_vars_acs5 <- 
  load_variables(year = 2019, dataset = "acs5")
```


```{r, Libraries, echo=FALSE}
library(tidyverse)
library(tidycensus)
library(ggridges)
library(dplyr)
library(tigris)
options(tigris_use_cache = TRUE)
library(leaflet)
library(sf)
library(packcircles)
library(ggplot2)
library(viridis)
library(ggbeeswarm)
library(ggiraph)
library(hrbrthemes)
```


B17018 below/above poverty level
```{r}
#below poverty level last 12 months
total_below_poverty = "B17018_002"
total_married_below = "B17018_003"
married_nohs = "B17018_004"
married_hs = "B17018_005"
married_some_col = "B17018_006"
married_bach_higher = "B17018_007"
single_tot = "B17018_008"
single_male_tot = "B17018_009"
#male
single_nohs ="B17018_010"
single_hs = "B17018_011"
single_some_col = "B17018_012"
single_bach_higher = "B17018_013"
#female
single_female_tot = "B17018_014"
single_f_nohs = "B17018_015"
single_f_hs = "B17018_016"
single_f_some_col = "B17018_017"
single_f_bach_higher = "B17018_018"

total_above_poverty = "B17018_019"
total_married_above = "B17018_020"
mar_above_nohs = "B17018_021"
mar_above_hs = "B17018_022"
mar_above_some_col = "B17018_023"
mar_above_bach = "B17018_024"

single_above_tot = "B17018_025"
male_tot_above = "B17018_026"
male_above_nohs = "B17018_027"
male_above_hs = "B17018_028"
male_above_somecol = "B17018_029"
male_above_bach = "B17018_030"

female_above_tot = "B17018_031"
f_above_nohs = "B17018_032"
f_above_hs = "B17018_033"
f_above_somecol = "B17018_034"
f_above_bach = "B17018_035"
```

```{r}
below_poverty <- get_acs(
  geography = "county",
  state = "MI",
  variables = c(Married_noHS = "B17018_004",
                Single_Male_noHS = "B17018_010",
                Single_Female_noHS = "B17018_015",
                Married_HS = "B17018_005",
                Single_Male_HS = "B17018_011",
                Single_Female_HS = "B17018_016",
                Married_Some_College = "B17018_006",
                Single_MSome_College = "B17018_012",
                Single_FSome_College = "B17018_017",
                Married_College = "B17018_007",
                Single_Male_College = "B17018_013",
                Single_Female_College = "B17018_018"),
  summary_var = "B17018_002"
) 

below_pov_percents <- below_poverty %>%
  mutate(percent = 100 * (estimate / summary_est)) %>%
  select(NAME, variable, percent)

no_HS <- get_acs(
  geography = "county",
  state = "MI",
  variables = c(Below_Married_noHS = "B17018_004",
                Below_Single_Male_noHS = "B17018_010",
                Below_Single_Female_noHS = "B17018_015",
                Above_Married_noHS = "B17018_021",
                Above_Single_Male_noHS = "B17018_027",
                Above_Single_Female_noHS = "B17018_032"),
  summary_var = "B17018_001"
) 
noHS_percents <- no_HS %>%
  mutate(percent = 100 * (estimate / summary_est)) %>%
  select(NAME, variable, percent)

HS <- get_acs(
  geography = "county",
  state = "MI",
  variables = c(Below_Married_HS = "B17018_005",
                Below_Single_Male_HS = "B17018_011",
                Below_Single_Female_HS = "B17018_016",
                Above_Married_HS = "B17018_022",
                Above_Single_Male_HS = "B17018_028",
                Above_Single_Female_HS = "B17018_033"),
  summary_var = "B17018_001"
)

HS_percents <- HS %>%
  mutate(percent = 100 * (estimate / summary_est)) %>%
  select(NAME, variable, percent)


somecol <- get_acs(
  geography = "county",
  state = "MI",
  variables = c(Below_Married_somecol = "B17018_006",
                Below_Single_Male_somecol = "B17018_012",
                Below_Single_Female_somecol = "B17018_017",
                Above_Married_somecol = "B17018_023",
                Above_Single_Male_somecol = "B17018_029",
                Above_Single_Female_somecol = "B17018_034"),
  summary_var = "B17018_001"
)

somecol_percents <- college %>%
  mutate(percent = 100 * (estimate / summary_est)) %>%
  select(NAME, variable, percent)

college <- get_acs(
  geography = "county",
  state = "MI",
  variables = c(Below_Married_college = "B17018_007",
                Below_Single_Male_college = "B17018_013",
                Below_Single_Female_college = "B17018_018",
                Above_Married_college = "B17018_024",
                Above_Single_Male_college = "B17018_023",
                Above_Single_Female_college = "B17018_035"),
  summary_var = "B17018_001"
)

college_percents <- college %>%
  mutate(percent = 100 * (estimate / summary_est)) %>%
  select(NAME, variable, percent)

```
```{r}
library(ggbeeswarm)

college2 <- get_acs(
  geography = "tract",
  state = "MI",
  variables = c(Below_Married_college = "B17018_007",
                Below_Single_Male_college = "B17018_013",
                Below_Single_Female_college = "B17018_018",
                Above_Married_college = "B17018_024",
                Above_Single_Male_college = "B17018_023",
                Above_Single_Female_college = "B17018_035"),
  summary_var = "B17018_001"
) %>%
  group_by(GEOID) %>%
  filter(estimate == max(estimate, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(estimate != 0)

ggplot(college2, aes(x = variable, y = summary_est, color = summary_est)) +
  geom_quasirandom(alpha = 0.5) + 
  coord_flip() + 
  theme_minimal(base_size = 13) + 
  scale_color_viridis_c(guide = FALSE)  + 
  labs(x = "Largest group in Census tract", 
       y = "Median household income", 
       title = "Household income distribution by largest racial/ethnic group", 
       subtitle = "Census tracts, New York City", 
       caption = "Data source: 2015-2019 ACS")

```

```{r}



# Plot
ggplot(below_pov_percents, aes(x = `percent`, y = `variable` , fill = ..x..)) +
  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) +
  scale_fill_viridis(name = "Inferno", option = "D") +
  labs(title = 'Percent of Population Below Poverty Level') +
  theme_ipsum() +
    theme(
      legend.position="none",
      panel.spacing = unit(0.1, "lines"),
      strip.text.x = element_text(size = 8)
    )
```
